#+TITLE: pbar generation

#+DESCRIPTION: Instructions to test pbars generation

* SETUP
  startdir=`pwd`
  setup mu2e
  cd ../../../
  Offline=`pwd`
  echo Offline set to $Offline
  source setup.sh
  cd $startdir
  user=`whoami`

* STAGE 0: From protons to inelastic vertices on production target 
** define stage and fclname
   user=`whoami`
   stage=0
   fclname=vertex_s${stage}.fcl
   file:vertex_s0.fcl
** Define working dir in /mu2e/data2
   stagedir=/mu2e/data2/users/${user}/pbar/stage$stage
   mkdir -p $stagedir
** Copy fcl in working dir and move there
   cp $fclname $stagedir
   cd $stagedir
** Define number of events log file and output file
   nev=10000
   logfile=stage${stage}_test${nev}.log
   rootFile=stage${stage}_test${nev}.root
   stageFile=stage${stage}_test${nev}.art
** Run fcl file
   mu2e -c $fclname -n $nev -T $rootFile | tee $logfile
   mv sim.owner.vertex_s0.version.sequencer.art $stageFile
*** Result
TrigReport Events total = 10000 passed = 10000 failed = 0
** Dump Data Products
   mu2e -c $Offline/Print/fcl/dumpDataProducts.fcl -s $stageFile -n 1 
*** The result is:
****   *Event* 
   mu2e::StatusG4                           g4run       pbars0  1355898525
   mu2e::SimParticlemv                      g4run       pbars0  2556726704
   mu2e::GenParticles                       generate    pbars0  3296348036
****   *SubRun* 
   mu2e::GenEventCount                      genCounter  pbars0  1037629646
uintmu2e::PhysicalVolumeInfomvstd::pairs    compressPV  pbars0  3468039105

** Come back 
   cd $startdir


* STAGE 1: From inelastic vertices to TS entrance (VD91) 
** define stage and fclname
   user=`whoami`
   stage=1
   prevstage=$(( $stage - 1 ))
   fclname=vertex_s1.fcl
   file:vertex_s1.fcl
** Define working dir in /mu2e/data2/users
   stagedir=/mu2e/data2/users/${user}/pbar/stage$stage   
   prevstagedir=/mu2e/data2/users/${user}/pbar/stage$prevstage
   mkdir -p $stagedir
** Copy fcl in working dir and move there
   cp $fclname $stagedir
   cd $stagedir
** Define number of events log file and output file 
   nev=10000
   logfile=stage${stage}_test${nev}.log
   rootFile=stage${stage}_test${nev}.root
   stageFile=stage${stage}_test${nev}.art
   prevstageFile=stage${prevstage}_test${nev}.art
** Run fcl file 
   mu2e -c $fclname -n $nev -T $rootFile -s ${prevstagedir}/$prevstageFile | tee $logfile
   mv sim.owner.pbar_s1toVD91.version.sequencer.art $stageFile
*** Number of events passed
    grep "Events total" $logfile
    returns:
    TrigReport Events total = 10000 passed = 18 failed = 9982

** Dump Data Products
   mu2e -c $Offline/Print/fcl/dumpDataProducts.fcl -s $stageFile -n 1 
*** The result is 
****     *Event*
***** pbars0 
     mu2e::StatusG4        g4run                      pbars0  1355898525
mu2e::SimParticlemv        g4run                      pbars0  2556726704
 mu2e::GenParticles      generate                     pbars0  3296348036 
***** pbars1 
 mu2e::StepPointMCs      g4filter    virtualdetector  pbars1   841414781
     mu2e::StatusG4         g4run                     pbars1  1238003676
mu2e::SimParticlemv      g4filter                     pbars1  1673729632
mu2e::SimParticlemv         g4run                     pbars1  2172632305
 mu2e::StepPointMCs      g4filter *VirtualDetectorPSPbarIn* pbars1  2609269859
mu2e::SimParticlemv     pbarWrite                     pbars1  2811951926

****     *SubRun*
mu2e::GenEventCount    genCounter                       pbars0  1037629646

** Come back 
   cd $startdir


* STAGE 2: From TS entrance (VD91) to Coll31Out (VD31) before TS3 window 
** define stage and fclname
   user=`whoami`
   stage=2
   prevstage=$(( $stage - 1 ))
   fclname=vertex_s2.fcl
   file:vertex_s2.fcl
** Define working dir in /mu2e/data2/users
   stagedir=/mu2e/data2/users/${user}/pbar/stage$stage
   prevstagedir=/mu2e/data2/users/${user}/pbar/stage$prevstage
   mkdir -p $stagedir
** Copy fcl in working dir and move there
   cp $fclname $stagedir
   cd $stagedir
** Define number of events log file and output file
   nev=10000
   logfile=stage${stage}_test${nev}.log
   rootFile=stage${stage}_test${nev}.root
   stageFile=stage${stage}_test${nev}.art
   prevstageFile=stage${prevstage}_test${nev}.art
** Run fcl file
   mu2e -c $fclname -n $nev -T $rootFile -s ${prevstagedir}/$prevstageFile | tee $logfile
   mv sim.owner.pbar_s2toColl31Out.version.sequencer.art $stageFile
*** Number of events passed
    grep "Events total" $logfile
    returns:
    TrigReport Events total = 18 passed = 0 failed = 18
** Dump Data Products
   mu2e -c $Offline/Print/fcl/dumpDataProducts.fcl -s $stageFile -n 1 
*** The result is (NO EVENTS!)
****     *Event*


****     *SubRun*

** Come back 
   cd $startdir


* STAGE 3: From Coll31Out (VD31) before TS3 window to TS5 
** define stage and fclname
   user=`whoami`
   stage=3
   prevstage=$(( $stage - 1 ))
   fclname=vertex_s3.fcl
   file:vertex_s3.fcl
** Define working dir in /mu2e/data2/users
   stagedir=/mu2e/data2/users/${user}/pbar/stage$stage
   prevstagedir=/mu2e/data2/users/${user}/pbar/stage$prevstage
   mkdir -p $stagedir
** Copy fcl in working dir and move there
   cp $fclname $stagedir
   cd $stagedir
** Define number of events log file and output file
   nev=10000
   logfile=stage${stage}_test${nev}.log
   rootFile=stage${stage}_test${nev}.root
   stageFile=stage${stage}_test${nev}.art
   prevstageFile=stage${prevstage}_test${nev}.art
** Run fcl file
   mu2e -c $fclname -n $nev -T $rootFile -s ${prevstagedir}/$prevstageFile | tee $logfile
   mv sim.owner.pbar_s3.version.sequencer.art $stageFile*** Number of events passed
*** Number of events passed
    grep "Events total" $logfile
    returns:
    TrigReport Events total = 0 passed = 0 failed = 0
** Dump Data Products
   mu2e -c $Offline/Print/fcl/dumpDataProducts.fcl -s $stageFile -n 1 
*** The result is  (NO EVENTS!)
****     *Event*


****     *SubRun*

** Come back 
   cd $startdir


* STAGE 4: From TS5 to Stopping Target 
** define stage and fclname
   user=`whoami`
   stage=4
   prevstage=$(( $stage - 1 ))
   fclname=vertex_s4.fcl
   file:vertex_s4.fcl 
   inspired by file:/mu2e/app/users/murat/beamline_prof/ts_warm_bore/760_1011/DS_pbar_760_1011.fcl
   including file:../../../JobConfig/beam/DS.fcl
** Define working dir in /mu2e/data2/users
   stagedir=/mu2e/data2/users/${user}/pbar/stage$stage
   prevstagedir=/mu2e/data2/users/${user}/pbar/stage$prevstage
   mkdir -p $stagedir
** Copy fcl in working dir and move there
   cp $fclname $stagedir
   cd $stagedir
** Define number of events log file and output file
   nev=10000
   logfile=stage${stage}_test${nev}.log
   rootFile=stage${stage}_test${nev}.root
   stageFile=stage${stage}_test${nev}.art
   prevstageFile=stage${prevstage}_test${nev}.art
** Run fcl file
   mu2e -c $fclname -n $nev -T $rootFile -s ${prevstagedir}/$prevstageFile | tee $logfile
   mv sim.owner.pbar_s4.version.sequencer.art $stageFile
*** Number of events passed
    grep "Events total" $logfile
    returns:
    TrigReport Events total = 0 passed = 0 failed = 0

** Dump Data Products
   mu2e -c $Offline/Print/fcl/dumpDataProducts.fcl -s $stageFile -n 1 
*** The result is (NO EVENTS!)
****     *Event*


****     *SubRun*

** Come back 
   cd $startdir

